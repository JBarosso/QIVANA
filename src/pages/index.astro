---
// ============================================
// HOME PAGE
// ============================================

import BaseLayout from '@/layouts/BaseLayout.astro';
import { getUser, getProfile } from '@/lib/auth';

// Type assertion pour supabase
const supabase = (Astro.locals as { supabase?: any }).supabase;

// Check if user is authenticated
const user = await getUser(supabase);
const profile = user && supabase ? await getProfile(supabase, user.id) : null;
---

<BaseLayout title="Qivana - Accueil">
  <main class="home">
    <div class="container">
      <section class="hero">
        <h1 class="hero__title">Qivana</h1>
        <p class="hero__subtitle">
          La plateforme de quiz nouvelle gÃ©nÃ©ration
        </p>
        
        {!user ? (
          <div class="hero__cta">
            <a href="/auth/signup" class="btn btn--primary">
              <span class="btn__text">CrÃ©er un compte</span>
            </a>
            <a href="/auth/login" class="btn btn--secondary">
              <span class="btn__text">Se connecter</span>
            </a>
            <a href="/pricing" class="btn btn--secondary btn--pricing">
              <span class="btn__text">ğŸ’ Voir les offres</span>
            </a>
            <a href="/leaderboard" class="btn btn--outline">
              <span class="btn__text">ğŸ† Classement</span>
            </a>
          </div>
        ) : (
          <div class="hero__cta">
            <a href="/quiz/setup" class="btn btn--primary">
              <span class="btn__text">ğŸ® Nouveau Quiz</span>
            </a>
            {profile && profile.plan !== 'freemium' && (
              <>
                <a href="/quiz/custom-quiz" class="btn btn--primary btn--custom-quiz">
                  <span class="btn__text">âœ¨ Quiz Custom</span>
                </a>
                <a href="/quiz/endless" class="btn btn--primary btn--endless">
                  <span class="btn__text">ğŸ”¥ Mode Endless</span>
                </a>
              </>
            )}
            {profile && profile.plan === 'premium+' && (
              <a href="/duel/create" class="btn btn--primary btn--duel">
                <span class="btn__text">âš”ï¸ CrÃ©er un Salon</span>
              </a>
            )}
            <a href="/leaderboard" class="btn btn--secondary">
              <span class="btn__text">ğŸ† Classement</span>
            </a>
            <a href="/profile" class="btn btn--secondary">
              <span class="btn__text">Mon profil</span>
            </a>
            {profile && profile.plan === 'freemium' && (
              <a href="/pricing" class="btn btn--secondary btn--upgrade">
                <span class="btn__text">ğŸ’ Passer Premium</span>
              </a>
            )}
            <a href="/auth/logout" class="btn btn--outline">
              <span class="btn__text">Se dÃ©connecter</span>
            </a>
          </div>
        )}
      </section>

      <!-- Section de test - Liens vers toutes les pages -->
      <section class="test-links">
        <h2 class="test-links__title">ğŸ”— Liens de test (dÃ©veloppement)</h2>
        
        <div class="test-links__grid">
          <div class="test-links__group">
            <h3 class="test-links__group-title">Pages principales</h3>
            <ul class="test-links__list">
              <li><a href="/pricing">ğŸ’ Pricing</a></li>
              <li><a href="/leaderboard">ğŸ† Leaderboard</a></li>
              <li><a href="/leaderboard/universe?universe=anime">ğŸ† Leaderboard par univers</a></li>
              <li><a href="/profile">ğŸ‘¤ Mon profil</a></li>
              <li><a href="/profile/edit">âœï¸ Ã‰diter profil</a></li>
              <li><a href="/quiz/setup">ğŸ® Nouveau quiz</a></li>
              <li><a href="/quiz/custom-quiz">âœ¨ Quiz custom</a></li>
              <li><a href="/quiz/ai-setup">ğŸ¤– Quiz AI setup</a></li>
            </ul>
          </div>

          <div class="test-links__group">
            <h3 class="test-links__group-title">Duels multijoueurs</h3>
            <ul class="test-links__list">
              <li><a href="/duel/create">âš”ï¸ CrÃ©er un salon</a></li>
              <li><a href="/duel/join">ğŸ”— Rejoindre un salon</a></li>
              <li><a href="/duel/lobby?salon=TEST123">ğŸ  Lobby (test)</a></li>
              <li><a href="/duel/play?room=TEST123">ğŸ® Play (test)</a></li>
              <li><a href="/duel/results?salon=TEST123">ğŸ† Results (test)</a></li>
            </ul>
          </div>

          <div class="test-links__group">
            <h3 class="test-links__group-title">Pages lÃ©gales</h3>
            <ul class="test-links__list">
              <li><a href="/mentions-legales">ğŸ“„ Mentions lÃ©gales</a></li>
              <li><a href="/confidentialite">ğŸ”’ ConfidentialitÃ©</a></li>
              <li><a href="/conditions-utilisation">ğŸ“‹ CGU</a></li>
              <li><a href="/conditions-vente">ğŸ’³ CGV</a></li>
            </ul>
          </div>

          <div class="test-links__group">
            <h3 class="test-links__group-title">Pages d'erreur</h3>
            <ul class="test-links__list">
              <li><a href="/404">âŒ Page 404</a></li>
              <li><a href="/500">âš¡ Page 500</a></li>
            </ul>
          </div>

          <div class="test-links__group">
            <h3 class="test-links__group-title">Admin</h3>
            <ul class="test-links__list">
              <li><a href="/admin">ğŸ”§ Dashboard admin</a></li>
              <li><a href="/admin/questions">â“ Gestion questions</a></li>
              <li><a href="/admin/duplicates">ğŸ”„ Doublons</a></li>
              <li><a href="/admin/flags">ğŸš© Signalements</a></li>
              <li><a href="/admin/analytics">ğŸ“Š Analytics</a></li>
              <li><a href="/admin/questions/new">â• Nouvelle question</a></li>
            </ul>
          </div>

          <div class="test-links__group">
            <h3 class="test-links__group-title">Authentification</h3>
            <ul class="test-links__list">
              <li><a href="/auth/login">ğŸ” Login</a></li>
              <li><a href="/auth/signup">ğŸ“ Signup</a></li>
              <li><a href="/auth/reset-password">ğŸ”‘ Reset password</a></li>
              <li><a href="/auth/update-password">ğŸ”„ Update password</a></li>
            </ul>
          </div>

          <div class="test-links__group">
            <h3 class="test-links__group-title">Paiement</h3>
            <ul class="test-links__list">
              <li><a href="/payment/success">âœ… Payment success</a></li>
              <li><a href="/payment/cancel">âŒ Payment cancel</a></li>
            </ul>
          </div>

          <div class="test-links__group">
            <h3 class="test-links__group-title">Quiz & RÃ©sultats</h3>
            <ul class="test-links__list">
              <li><a href="/quiz/play?session=TEST123">â–¶ï¸ Play quiz (test)</a></li>
              <li><a href="/quiz/results?session=TEST123">ğŸ“Š RÃ©sultats quiz (test)</a></li>
            </ul>
          </div>

          <div class="test-links__group">
            <h3 class="test-links__group-title">Modes de jeu</h3>
            <ul class="test-links__list">
              <li><a href="/quiz/endless">ğŸ”¥ Mode Endless (vs IA)</a></li>
              <li><a href="/duel/create?mode=battle_royal">âš”ï¸ Battle Royal (bientÃ´t)</a></li>
            </ul>
          </div>

          <div class="test-links__group">
            <h3 class="test-links__group-title">Profils publics</h3>
            <ul class="test-links__list">
              <li><a href="/profile/test-user">ğŸ‘¤ Profil public (test)</a></li>
            </ul>
          </div>
        </div>
      </section>
    </div>
  </main>
</BaseLayout>

<style lang="scss">
  @use '@/styles/pages/auth';
  @use '@/styles/pages/home';

  .home {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--color-neutral-900) 0%, var(--color-neutral-800) 100%);
  }

  .container {
    max-width: 800px;
    margin: 0 auto;
    padding: var(--space-4);
  }

  .hero {
    text-align: center;

    &__title {
      font-family: var(--font-secondary);
      font-size: var(--fs-10);
      background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: var(--space-4);
      font-weight: var(--font-weight-bold);
    }

    &__subtitle {
      font-family: var(--font-primary);
      font-size: var(--fs-4);
      color: var(--color-text-muted);
      margin-bottom: var(--space-8);
    }

    &__cta {
      display: flex;
      gap: var(--space-3);
      justify-content: center;
      margin-bottom: var(--space-8);
      flex-wrap: wrap;
    }

    &__status {
      font-size: var(--fs-2);
      color: var(--color-text-muted);
      font-weight: var(--font-weight-medium);
      line-height: 1.6;
    }
  }

  .test-links {
    margin-top: var(--space-12);
    padding: var(--space-6);
    background: var(--color-surface);
    border-radius: var(--radius-4);
    border: 2px dashed var(--color-border);

    &__title {
      font-size: var(--fs-5);
      color: var(--color-text);
      margin-bottom: var(--space-6);
      text-align: center;
      font-weight: var(--font-weight-semibold);
    }

    &__grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-6);
    }

    &__group {
      &-title {
        font-size: var(--fs-4);
        color: var(--color-primary);
        margin-bottom: var(--space-3);
        font-weight: var(--font-weight-semibold);
      }
    }

    &__list {
      list-style: none;
      padding: 0;
      margin: 0;

      li {
        margin-bottom: var(--space-2);

        a {
          display: block;
          padding: var(--space-2) var(--space-3);
          color: var(--color-text);
          text-decoration: none;
          border-radius: var(--radius-2);
          transition: all var(--transition-fast);
          font-size: var(--fs-3);

          &:hover {
            background: var(--color-background);
            color: var(--color-primary);
            transform: translateX(4px);
          }
        }
      }
    }
  }

  @media (max-width: 768px) {
    .test-links__grid {
      grid-template-columns: 1fr;
    }
  }
</style>
