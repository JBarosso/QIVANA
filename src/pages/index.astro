---
// ============================================
// HOME PAGE
// ============================================

import BaseLayout from '@/layouts/BaseLayout.astro';
import { getUser, getProfile } from '@/lib/auth';

// Type assertion pour supabase
const supabase = (Astro.locals as { supabase?: any }).supabase;

// Check if user is authenticated
const user = await getUser(supabase);
const profile = user && supabase ? await getProfile(supabase, user.id) : null;
---

<BaseLayout title="Qivana - Accueil">
  <main class="home">
    <div class="container">
      <section class="hero">
        <h1 class="hero__title">Qivana</h1>
        <p class="hero__subtitle">
          La plateforme de quiz geek alimentÃ©e par l'IA
        </p>
        
        {!user ? (
          <div class="hero__cta">
            <a href="/auth/signup" class="btn btn--primary">
              <span class="btn__text">CrÃ©er un compte</span>
            </a>
            <a href="/auth/login" class="btn btn--secondary">
              <span class="btn__text">Se connecter</span>
            </a>
            <a href="/pricing" class="btn btn--secondary btn--pricing">
              <span class="btn__text">ğŸ’ Voir les offres</span>
            </a>
            <a href="/leaderboard" class="btn btn--outline">
              <span class="btn__text">ğŸ† Classement</span>
            </a>
          </div>
        ) : (
          <div class="hero__cta">
            <a href="/quiz/setup" class="btn btn--primary">
              <span class="btn__text">ğŸ® Nouveau Quiz</span>
            </a>
            {profile && profile.plan !== 'freemium' && (
              <a href="/quiz/custom-quiz" class="btn btn--primary btn--custom-quiz">
                <span class="btn__text">âœ¨ Quiz Custom</span>
              </a>
            )}
            {profile && profile.plan === 'premium+' && (
              <a href="/duel/create" class="btn btn--primary btn--duel">
                <span class="btn__text">âš”ï¸ CrÃ©er un Salon</span>
              </a>
            )}
            <a href="/leaderboard" class="btn btn--secondary">
              <span class="btn__text">ğŸ† Classement</span>
            </a>
            <a href="/profile" class="btn btn--secondary">
              <span class="btn__text">Mon profil</span>
            </a>
            {profile && profile.plan === 'freemium' && (
              <a href="/pricing" class="btn btn--secondary btn--upgrade">
                <span class="btn__text">ğŸ’ Passer Premium</span>
              </a>
            )}
            <a href="/auth/logout" class="btn btn--outline">
              <span class="btn__text">Se dÃ©connecter</span>
            </a>
          </div>
        )}

        <p class="hero__status">
          âœ… Milestone 1 - Database Schema Complete<br>
          âœ… Milestone 2 - Authentication Complete<br>
          âœ… Milestone 3 - Core Quiz Engine (DB Quizzes)<br>
          âœ… Milestone 4 - AI Quiz Generator (Predefined Universes)<br>
          âœ… Milestone 5 - Quiz Custom (IA)
        </p>
      </section>
    </div>
  </main>
</BaseLayout>

<style lang="scss">
  @use '@/styles/pages/auth';
  @use '@/styles/pages/home';

  .home {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--color-neutral-900) 0%, var(--color-neutral-800) 100%);
  }

  .container {
    max-width: 800px;
    margin: 0 auto;
    padding: var(--space-4);
  }

  .hero {
    text-align: center;

    &__title {
      font-family: var(--font-secondary);
      font-size: var(--fs-10);
      background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: var(--space-4);
      font-weight: var(--font-weight-bold);
    }

    &__subtitle {
      font-family: var(--font-primary);
      font-size: var(--fs-4);
      color: var(--color-text-muted);
      margin-bottom: var(--space-8);
    }

    &__cta {
      display: flex;
      gap: var(--space-3);
      justify-content: center;
      margin-bottom: var(--space-8);
      flex-wrap: wrap;
    }

    &__status {
      font-size: var(--fs-2);
      color: var(--color-text-muted);
      font-weight: var(--font-weight-medium);
      line-height: 1.6;
    }
  }
</style>
